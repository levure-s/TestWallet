<html><body><script src="/socket.io/socket.io.js"></script>
    <script>
        window.onload = function () {
            connectSocket()
        }

        var socket

        function connectSocket() {
            socket = io()

            socket.on('notice_wallet', (addr) => {
                showAddress(addr)
                socket.emit('call_info',0)
            })

            socket.on('notice_info', (msg) => {
                updateScreen(JSON.parse(msg))
            })

            socket.on('notice_tx', (msg) => {
                showTx(msg)
                n = document.getElementById("p1index").value||0
                socket.emit('call_info',n)
            })

            socket.on('notice_mnemonic', (msg) => {
                showMnemonic(msg)
            })
            

            socket.connect()
            socket.emit('call_info',0)
        }

        function updateScreen(j){
            document.getElementById("addr").innerHTML = j.addr
            document.getElementById("balance").innerHTML = j.Balance
            document.getElementById("ETHaddr").innerHTML = j.ETHaddr
            document.getElementById("ETHbalance").innerHTML = j.ETHbalance
        }

        function showAddress(addr){
            document.getElementById("p0result").innerHTML = addr
        }

        function changeAddress(){
            n = document.getElementById("p1index").value
            socket.emit('call_info',parseInt(n))
        }

        function showTx(tx){
            document.getElementById("p2result").innerHTML = tx
        }

        function callCreate(){
            socket.emit('call_create')
        }

        function callSend(){
            var coin = document.getElementById("coin").value
            console.log(coin)
            var v = {
                from: document.getElementById("p1index").value,
                addr: document.getElementById("p2toaddress").value,
                amount: document.getElementById("p2amount").value
            }
            if(coin == 2){
                v.from = "eth"
                socket.emit('send_coins', JSON.stringify(v));
                return
            }
            socket.emit('send_coins', JSON.stringify(v));
        }

        function callMnemonic(){
            socket.emit('call_mnemonic')
        }

        function showMnemonic(mnemonic){
            document.getElementById("p3result").innerHTML = mnemonic
        }


    </script>

    <main>
        <div class="area_title">
            <font size="+2">TEST WALLET</font> (Address: <span id="addr"></span>,ETHacount: <span id="ETHaddr"></span>
            , BTC残高: <span id="balance"></span> Satoshi,ETH残高: <span id="ETHbalance"></span> wei)
        </div>
        <hr>
        <div class = "area_p1">
            <span id="p1title"><font size="+2">◆BTCアドレスを切り替える！</font></span><br><br>
            アドレス（０～１０）：<input type="number" id="p1index" max="10" min="0">
            <input type="button" id="p1button" value="切替" onclick="changeAddress();"/>
            　<font color="red"><span id="p1result"></span></font>
        </div>
        <br><hr>
        <div class = "area_p2">
            <span id="p2title"><font size="+2">◆送金する！</font></span><br><br>
            通貨：<select name="coin" id="coin">
                <option value="1">ビットコイン</option>
                <option value="2">イーサ</option>
            </select>
            受取人（アドレス）：<input type="text" id="p2toaddress" size="48"/>
            金額： <input type="text" id="p2amount"/>Satoshi/wei<br><br>
            <input type="button" id="p2button" value="送金" onclick="callSend();"/>
            　<font color="red"><span id="p2result"></span></font><br><br>
        </div><br>
        <br><hr>
        <div class = "area_p3">
            <span id="p3title"><font size="+2">◆バックアップ情報を表示する！</font></span><br><br>
            <input type="button" id="p3button" value="パスフレーズを表示" onclick="callMnemonic();"/>
            　<font color="red"><span id="p3result"></span></font><br><br>
        </div>


    </main>
    
</body>
</html>